# Questão 3

```{r}
#| echo: false
library(tidyverse)
```


## Itens A, B e C
![](/input/imagens/lista2/Exercicio4.jpg){height="90%"}

## Item D

```{r}
rbetaretang_estocastica <- function(n, a, b, p) {
  bernoulli_vec <- sample(c(0, 1), size = n, replace = TRUE, prob = c(1 - p, p))
  result <- numeric(n)
  for(i in seq_along(bernoulli_vec)) {
    if(bernoulli_vec[i] == 0) result[i] <- rbeta(1, a, b)
    else result[i] <- runif(1)
  }
  return(result)
}

```
Resultados do método abaixo.

## Item F
```{r}
dbetaretang <- function(x, a, b, p) {
  if(x < 0 | x > 1) return(0)
  else return((1 - p) * 1/beta(a, b) * x^(a-1) * (1-x)^(b-1) + p)
}
pbetaretang <- function(x, a, b, p) {
  integrate(dbetaretang, lower = 0, upper = x, a = a, b = b, p = p)[[1]]
}

dbetaretang <- Vectorize(dbetaretang, vectorize.args = 'x', SIMPLIFY = TRUE)
pbetaretang <- Vectorize(pbetaretang, vectorize.args = 'x', SIMPLIFY = TRUE)

rbetaretang_rej <- function(n, a, b, p) {
  unif_vec <- runif(n); result <- numeric(n)
  u <- 0.3; sigma <- 0.4; C <- 1.63909
  for(i in seq_along(unif_vec)) {
    x <- rnorm(1, u, sigma)
    while(unif_vec[i] > dbetaretang(x, a, b, p)/(dnorm(x, u, sigma) * C)) {
      x <- rnorm(1, u, sigma)}
    result[i] <- x
  }
  return(result)
}

rbetaretang_inv <- function(n, a, b, p) {
  unif_vec <- runif(n); result <- numeric(n)
  for(i in seq_along(unif_vec)) result[i] <- 
      uniroot(function(x) {pbetaretang(x, a = a, b = b, p = p) - unif_vec[i]},
              interval = c(-0.1, 1.1))$root
  return(result)
}

```

```{r aquelemesmo}
#| echo: false
#| layout-ncol: 2

n <- 5000
a <- 2
b <- 3
p <- 0.2

dados <- rbind(
  data.frame(
    Método = 'Estocástico',
    Valor = rbetaretang_estocastica(n, a, b, p)
  ),
  data.frame(
    Método = 'Rejeição',
    Valor = rbetaretang_rej(n, a, b, p)
  ),
  data.frame(
    Método = 'MTI',
    Valor = rbetaretang_inv(n, a, b, p)
  )
) %>% 
  group_by(Método) %>%
  mutate(
    media = {
      result <- numeric(n)
      
      for(i in 1:n) {
        result[i] <- mean(Valor[1:i])
      }
      
      result
    },
    variancia = {
      result <- numeric(n)
      
      for(i in 1:n) {
        result[i] <- mean(Valor[1:i])
      }
      
      result
    }
  )

ggplot(
  dados,
  aes(x = Valor, color = Método)
) +
  geom_density() +
  geom_function(aes(color = 'Densidade'), fun = dbetaretang, args = list(a = a, b = b, p = p))


ggplot(
  dados,
  aes(x = Método, y = Valor)
) +
  geom_boxplot()

ggplot(dados,
       aes(y = media, x = rep(1:n, 3), color = Método)) +
  geom_line()

ggplot(dados,
       aes(y = variancia, x = rep(1:n, 3), color = Método)) +
  geom_line()

```

